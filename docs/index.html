---

title: NeoCov


keywords: fastai
sidebar: home_sidebar

summary: "Semantic change and social semantic variation of Covid-related English neologisms on Reddit."
description: "Semantic change and social semantic variation of Covid-related English neologisms on Reddit."
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">neocov.read_data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">neocov.preproc</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">neocov.type_emb</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">neocov.communities</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">gensim.models</span> <span class="kn">import</span> <span class="n">Word2Vec</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DATA_DIR</span> <span class="o">=</span> <span class="s1">&#39;../data/&#39;</span>
<span class="n">COMMENTS_DIAC_DIR</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DATA_DIR</span><span class="si">}</span><span class="s1">comments/by_date/&#39;</span>
<span class="n">OUT_DIR</span> <span class="o">=</span> <span class="s1">&#39;../out/&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Variables">Variables<a class="anchor-link" href="#Variables"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Semantic-change">Semantic change<a class="anchor-link" href="#Semantic-change"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Read-data">Read data<a class="anchor-link" href="#Read-data"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Get-file-paths">Get file paths<a class="anchor-link" href="#Get-file-paths"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YEAR</span> <span class="o">=</span> <span class="s1">&#39;2019&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comment_paths_year</span> <span class="o">=</span> <span class="n">get_comments_paths_year</span><span class="p">(</span><span class="n">COMMENTS_DIAC_DIR</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Read-comments">Read comments<a class="anchor-link" href="#Read-comments"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">comments</span> <span class="o">=</span> <span class="n">read_comm_csvs</span><span class="p">(</span><span class="n">comment_paths_year</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comments</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Pre-process-comments">Pre-process comments<a class="anchor-link" href="#Pre-process-comments"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">comments</span> <span class="o">=</span> <span class="n">clean_comments</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Train-models">Train models<a class="anchor-link" href="#Train-models"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Create-corpus">Create corpus<a class="anchor-link" href="#Create-corpus"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="n">Corpus</span><span class="p">(</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Train-model">Train model<a class="anchor-link" href="#Train-model"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Save-model">Save model<a class="anchor-link" href="#Save-model"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">models/</span><span class="si">{</span><span class="n">YEAR</span><span class="si">}</span><span class="s1">.model&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Load-models">Load models<a class="anchor-link" href="#Load-models"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_2019</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">models/2019.model&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_2020</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">models/2020.model&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Align-models">Align models<a class="anchor-link" href="#Align-models"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_2019_vocab</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_2019</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)</span>
<span class="n">model_2020_vocab</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_2020</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">smart_procrustes_align_gensim</span><span class="p">(</span><span class="n">model_2019</span><span class="p">,</span> <span class="n">model_2020</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>190756 190756
190756 190756
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;gensim.models.word2vec.Word2Vec at 0x184aee710&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_2019</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_2020</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">vectors</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">models_vocab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Words&#39;</span><span class="p">],</span>
    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;2019&#39;</span><span class="p">,</span> <span class="n">model_2019_vocab</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;2020&#39;</span><span class="p">,</span> <span class="n">model_2020_vocab</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;intersection&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_2019</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)]</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">models_vocab</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model</th>
      <th>Words</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019</td>
      <td>252564</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020</td>
      <td>277707</td>
    </tr>
    <tr>
      <th>2</th>
      <td>intersection</td>
      <td>190756</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">models_vocab</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">models_vocab.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Measure-distances">Measure distances<a class="anchor-link" href="#Measure-distances"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">distances</span> <span class="o">=</span> <span class="n">measure_distances</span><span class="p">(</span><span class="n">model_2019</span><span class="p">,</span> <span class="n">model_2020</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">distances</span>\
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;dist_sem&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lex</th>
      <th>dist_sem</th>
      <th>freq_1</th>
      <th>freq_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>182174</th>
      <td>financiados</td>
      <td>1.270406</td>
      <td>7</td>
      <td>9</td>
    </tr>
    <tr>
      <th>164003</th>
      <td>______________________________________________...</td>
      <td>1.257892</td>
      <td>9</td>
      <td>10</td>
    </tr>
    <tr>
      <th>181373</th>
      <td>2ffireemblem</td>
      <td>1.247719</td>
      <td>8</td>
      <td>9</td>
    </tr>
    <tr>
      <th>190665</th>
      <td>obedece</td>
      <td>1.239514</td>
      <td>7</td>
      <td>8</td>
    </tr>
    <tr>
      <th>126286</th>
      <td>1281</td>
      <td>1.218590</td>
      <td>14</td>
      <td>16</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>175</th>
      <td>years</td>
      <td>0.027202</td>
      <td>175105</td>
      <td>192696</td>
    </tr>
    <tr>
      <th>174923</th>
      <td>ppx_yo_dt_b_asin_title_o09_s00</td>
      <td>0.025620</td>
      <td>8</td>
      <td>9</td>
    </tr>
    <tr>
      <th>46509</th>
      <td>imagestabilization</td>
      <td>0.025614</td>
      <td>85</td>
      <td>93</td>
    </tr>
    <tr>
      <th>144055</th>
      <td>ppx_yo_dt_b_asin_title_o03_s00</td>
      <td>0.018814</td>
      <td>11</td>
      <td>13</td>
    </tr>
    <tr>
      <th>68400</th>
      <td>u5e9htr</td>
      <td>0.012333</td>
      <td>42</td>
      <td>46</td>
    </tr>
  </tbody>
</table>
<p>190756 rows × 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>TODO: filter by true type frequency; <code>Gensim</code>'s type frequency seems incorrect; it probably reflects frequency ranks instead of total counts.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_sem_change_cands</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">freq_min</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">sem_change_cands</span> <span class="o">=</span> <span class="p">(</span><span class="n">distances</span>
        <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;freq_1 &gt; @freq_min and freq_2 &gt; @freq_min&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;lex.str.isalpha() == True&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;lex.str.len() &gt; 3&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;dist_sem&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">sem_change_cands</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">freq_min</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">sem_change_cands</span> <span class="o">=</span> <span class="n">distances</span>\
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;freq_1 &gt; @freq_min and freq_2 &gt; @freq_min&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;lex.str.isalpha() == True&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;lex.str.len() &gt; 3&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;dist_sem&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">sem_change_cands</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lex</th>
      <th>dist_sem</th>
      <th>freq_1</th>
      <th>freq_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>maskless</td>
      <td>1.100272</td>
      <td>118</td>
      <td>127</td>
    </tr>
    <tr>
      <th>1</th>
      <td>lockdowns</td>
      <td>1.070362</td>
      <td>940</td>
      <td>991</td>
    </tr>
    <tr>
      <th>2</th>
      <td>sunsetting</td>
      <td>1.039729</td>
      <td>111</td>
      <td>120</td>
    </tr>
    <tr>
      <th>3</th>
      <td>chaz</td>
      <td>1.010383</td>
      <td>190</td>
      <td>202</td>
    </tr>
    <tr>
      <th>4</th>
      <td>childe</td>
      <td>0.957373</td>
      <td>209</td>
      <td>222</td>
    </tr>
    <tr>
      <th>5</th>
      <td>cerb</td>
      <td>0.957321</td>
      <td>315</td>
      <td>333</td>
    </tr>
    <tr>
      <th>6</th>
      <td>megalodon</td>
      <td>0.937414</td>
      <td>752</td>
      <td>792</td>
    </tr>
    <tr>
      <th>7</th>
      <td>spreader</td>
      <td>0.932299</td>
      <td>164</td>
      <td>175</td>
    </tr>
    <tr>
      <th>8</th>
      <td>corona</td>
      <td>0.927504</td>
      <td>3553</td>
      <td>3684</td>
    </tr>
    <tr>
      <th>9</th>
      <td>ventilators</td>
      <td>0.925241</td>
      <td>384</td>
      <td>405</td>
    </tr>
    <tr>
      <th>10</th>
      <td>woul</td>
      <td>0.924612</td>
      <td>197</td>
      <td>210</td>
    </tr>
    <tr>
      <th>11</th>
      <td>rona</td>
      <td>0.922876</td>
      <td>410</td>
      <td>433</td>
    </tr>
    <tr>
      <th>12</th>
      <td>revamping</td>
      <td>0.914010</td>
      <td>129</td>
      <td>139</td>
    </tr>
    <tr>
      <th>13</th>
      <td>pandemic</td>
      <td>0.912615</td>
      <td>9504</td>
      <td>9957</td>
    </tr>
    <tr>
      <th>14</th>
      <td>snapchatting</td>
      <td>0.912304</td>
      <td>2262</td>
      <td>2345</td>
    </tr>
    <tr>
      <th>15</th>
      <td>diys</td>
      <td>0.910311</td>
      <td>492</td>
      <td>519</td>
    </tr>
    <tr>
      <th>16</th>
      <td>rittenhouse</td>
      <td>0.904660</td>
      <td>181</td>
      <td>193</td>
    </tr>
    <tr>
      <th>17</th>
      <td>hyperlinked</td>
      <td>0.904281</td>
      <td>511</td>
      <td>538</td>
    </tr>
    <tr>
      <th>18</th>
      <td>pandemics</td>
      <td>0.902996</td>
      <td>296</td>
      <td>311</td>
    </tr>
    <tr>
      <th>19</th>
      <td>rpan</td>
      <td>0.891097</td>
      <td>542</td>
      <td>573</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sem_change_cands_out</span> <span class="o">=</span> <span class="n">sem_change_cands</span>\
    <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;dist_sem&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">index_1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">dist_sem</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;dist_sem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">dist_sem</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;dist_sem&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">))</span>\
    <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;index_1&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;lex&#39;</span><span class="p">:</span> <span class="s1">&#39;Lexeme&#39;</span><span class="p">,</span> <span class="s1">&#39;dist_sem&#39;</span><span class="p">:</span> <span class="s1">&#39;SemDist&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sem_change_cands_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">sem_change_cands.csv&#39;</span><span class="p">,</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Lexeme&#39;</span><span class="p">,</span> <span class="s1">&#39;SemDist&#39;</span><span class="p">],</span>
        <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inspect-nearest-neighbours-of-lexemes">Inspect nearest neighbours of lexemes<a class="anchor-link" href="#Inspect-nearest-neighbours-of-lexemes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">LEX_NBS</span> <span class="o">=</span> <span class="s1">&#39;lockdown&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nbs_model_1</span><span class="p">,</span> <span class="n">nbs_model_2</span> <span class="o">=</span> <span class="n">get_nearest_neighbours_models</span><span class="p">(</span>
    <span class="n">lex</span><span class="o">=</span><span class="n">LEX_NBS</span><span class="p">,</span> 
    <span class="n">freq_min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">model_1</span><span class="o">=</span><span class="n">model_2019</span><span class="p">,</span> 
    <span class="n">model_2</span><span class="o">=</span><span class="n">model_2020</span><span class="p">,</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">display</span><span class="p">(</span>
    <span class="n">nbs_model_1</span><span class="p">,</span>
    <span class="n">nbs_model_2</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">/var/folders/gp/dw55jb3d3gl6jn22rscvxjm40000gn/T/ipykernel_74735/1602480840.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>     lex<span class="ansi-blue-fg">=</span>LEX_NBS<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     freq_min<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg">     </span>model_1<span class="ansi-blue-fg">=</span>model_2019<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>     model_2<span class="ansi-blue-fg">=</span>model_2020<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>     k<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">10</span>

<span class="ansi-red-fg">NameError</span>: name &#39;model_2019&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nbs_model_1</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">neighbours/</span><span class="si">{</span><span class="n">LEX_NBS</span><span class="si">}</span><span class="s1">_2019.csv&#39;</span><span class="p">)</span>
<span class="n">nbs_model_2</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">neighbours/</span><span class="si">{</span><span class="n">LEX_NBS</span><span class="si">}</span><span class="s1">_2020.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Social-semantic-variation">Social semantic variation<a class="anchor-link" href="#Social-semantic-variation"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Inspect-subreddits">Inspect subreddits<a class="anchor-link" href="#Inspect-subreddits"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="read-comments">read comments<a class="anchor-link" href="#read-comments"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comments_dir_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../data/comments/lexeme/&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comments_paths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">comments_dir_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Covid*.csv&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">comments</span> <span class="o">=</span> <span class="n">read_comm_csvs</span><span class="p">(</span><span class="n">comments_paths</span><span class="p">)</span>
<span class="n">comments</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 34.2 s, sys: 3.62 s, total: 37.8 s
Wall time: 37.9 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>author</th>
      <th>body</th>
      <th>created_utc</th>
      <th>id</th>
      <th>subreddit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Gloob_Patrol</td>
      <td>I assume you work too so he's feeling like he ...</td>
      <td>2020-09-08 18:53:06</td>
      <td>g4guhl5</td>
      <td>LongDistance</td>
    </tr>
    <tr>
      <th>1</th>
      <td>amtrusc</td>
      <td>Strep swab and culture negative, I’m sure? Cou...</td>
      <td>2020-09-08 18:53:08</td>
      <td>g4guhsm</td>
      <td>tonsilstones</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Ephuntz</td>
      <td>&amp;gt;Good point. My apologies. It's just becomi...</td>
      <td>2020-09-08 18:53:09</td>
      <td>g4guhua</td>
      <td>Winnipeg</td>
    </tr>
    <tr>
      <th>3</th>
      <td>cstransfer</td>
      <td>Have you noticed an increase of people going e...</td>
      <td>2020-09-08 18:53:09</td>
      <td>g4guhu4</td>
      <td>financialindependence</td>
    </tr>
    <tr>
      <th>4</th>
      <td>IlliniWhoDat</td>
      <td>I haven't.  I have seen it online, but haven't...</td>
      <td>2020-09-08 18:53:13</td>
      <td>g4gui6o</td>
      <td>KoreanBeauty</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3800760</th>
      <td>willw</td>
      <td>Last group pre COVID!</td>
      <td>2020-07-01 21:59:48</td>
      <td>fwmqfbj</td>
      <td>jawsurgery</td>
    </tr>
    <tr>
      <th>3800761</th>
      <td>Daikataro</td>
      <td>If everyone is infected with COVID, new cases ...</td>
      <td>2020-07-01 21:59:49</td>
      <td>fwmqff2</td>
      <td>politics</td>
    </tr>
    <tr>
      <th>3800762</th>
      <td>StabYourBloodIntoMe</td>
      <td>&amp;gt; If the mortality rate is actually decreas...</td>
      <td>2020-07-01 21:59:50</td>
      <td>fwmqfib</td>
      <td>dataisbeautiful</td>
    </tr>
    <tr>
      <th>3800763</th>
      <td>Shorse_rider</td>
      <td>I was a freelancer until covid and earned more...</td>
      <td>2020-07-01 21:59:55</td>
      <td>fwmqfuw</td>
      <td>AskWomen</td>
    </tr>
    <tr>
      <th>3800764</th>
      <td>Gayfetus</td>
      <td>This is actually fascinating and possibly incr...</td>
      <td>2020-07-01 21:59:57</td>
      <td>fwmqfz0</td>
      <td>Coronavirus</td>
    </tr>
  </tbody>
</table>
<p>3800765 rows × 5 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>TODO: filter comments</p>
<ul>
<li>[ ] remove duplicates</li>
<li>[ ] remove bots</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="get-subreddit-counts">get subreddit counts<a class="anchor-link" href="#get-subreddit-counts"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">subr_counts</span> <span class="o">=</span> <span class="n">get_subr_counts</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">subr_counts_plt</span> <span class="o">=</span> <span class="n">plot_subr_counts</span><span class="p">(</span><span class="n">subr_counts</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">subr_counts_plt</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">

<div id="altair-viz-be48b7c570e146cbb8e25c8f162c7758"></div>
<script type="text/javascript">
  var VEGA_DEBUG = (typeof VEGA_DEBUG == "undefined") ? {} : VEGA_DEBUG;
  (function(spec, embedOpt){
    let outputDiv = document.currentScript.previousElementSibling;
    if (outputDiv.id !== "altair-viz-be48b7c570e146cbb8e25c8f162c7758") {
      outputDiv = document.getElementById("altair-viz-be48b7c570e146cbb8e25c8f162c7758");
    }
    const paths = {
      "vega": "https://cdn.jsdelivr.net/npm//vega@5?noext",
      "vega-lib": "https://cdn.jsdelivr.net/npm//vega-lib?noext",
      "vega-lite": "https://cdn.jsdelivr.net/npm//vega-lite@4.17.0?noext",
      "vega-embed": "https://cdn.jsdelivr.net/npm//vega-embed@6?noext",
    };

    function maybeLoadScript(lib, version) {
      var key = `${lib.replace("-", "")}_version`;
      return (VEGA_DEBUG[key] == version) ?
        Promise.resolve(paths[lib]) :
        new Promise(function(resolve, reject) {
          var s = document.createElement('script');
          document.getElementsByTagName("head")[0].appendChild(s);
          s.async = true;
          s.onload = () => {
            VEGA_DEBUG[key] = version;
            return resolve(paths[lib]);
          };
          s.onerror = () => reject(`Error loading script: ${paths[lib]}`);
          s.src = paths[lib];
        });
    }

    function showError(err) {
      outputDiv.innerHTML = `<div class="error" style="color:red;">${err}</div>`;
      throw err;
    }

    function displayChart(vegaEmbed) {
      vegaEmbed(outputDiv, spec, embedOpt)
        .catch(err => showError(`Javascript Error: ${err.message}<br>This usually means there's a typo in your chart specification. See the javascript console for the full traceback.`));
    }

    if(typeof define === "function" && define.amd) {
      requirejs.config({paths});
      require(["vega-embed"], displayChart, err => showError(`Error loading script: ${err.message}`));
    } else {
      maybeLoadScript("vega", "5")
        .then(() => maybeLoadScript("vega-lite", "4.17.0"))
        .then(() => maybeLoadScript("vega-embed", "6"))
        .catch(showError)
        .then(() => displayChart(vegaEmbed));
    }
  })({"config": {"view": {"continuousWidth": 400, "continuousHeight": 300}}, "data": {"name": "data-4458ddb2ac6f25acdcc8df0cbd1ee925"}, "mark": "bar", "encoding": {"x": {"field": "comments_num", "type": "quantitative"}, "y": {"field": "subreddit", "sort": "-x", "type": "nominal"}}, "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json", "datasets": {"data-4458ddb2ac6f25acdcc8df0cbd1ee925": [{"subreddit": "Coronavirus", "comments_num": 173397}, {"subreddit": "AskReddit", "comments_num": 142358}, {"subreddit": "politics", "comments_num": 136270}, {"subreddit": "worldnews", "comments_num": 87336}, {"subreddit": "news", "comments_num": 55561}, {"subreddit": "conspiracy", "comments_num": 52780}, {"subreddit": "wallstreetbets", "comments_num": 40424}, {"subreddit": "DDnews", "comments_num": 37062}, {"subreddit": "AmItheAsshole", "comments_num": 35861}, {"subreddit": "pics", "comments_num": 27597}, {"subreddit": "ukpolitics", "comments_num": 25970}, {"subreddit": "LockdownSkepticism", "comments_num": 22906}, {"subreddit": "PublicFreakout", "comments_num": 22891}, {"subreddit": "canada", "comments_num": 22754}, {"subreddit": "Conservative", "comments_num": 21673}, {"subreddit": "nfl", "comments_num": 20222}, {"subreddit": "memes", "comments_num": 18200}, {"subreddit": "COVID19", "comments_num": 17570}, {"subreddit": "ontario", "comments_num": 16386}, {"subreddit": "relationship_advice", "comments_num": 16143}]}}, {"mode": "vega-lite"});
</script>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">subr_counts_plt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">subr_counts.png&#39;</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Train-models">Train models<a class="anchor-link" href="#Train-models"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">COMMENTS_DIR_SUBR</span> <span class="o">=</span> <span class="s1">&#39;../data/comments/subr/&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SUBR</span> <span class="o">=</span> <span class="s1">&#39;Coronavirus&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fpaths</span> <span class="o">=</span> <span class="n">get_comments_paths_subr</span><span class="p">(</span><span class="n">COMMENTS_DIR_SUBR</span><span class="p">,</span> <span class="n">SUBR</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">comments</span> <span class="o">=</span> <span class="n">read_comm_csvs</span><span class="p">(</span><span class="n">fpaths</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 24 s, sys: 2.71 s, total: 26.7 s
Wall time: 26.8 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">comments</span> <span class="o">=</span> <span class="n">clean_comments</span><span class="p">(</span><span class="n">comments</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>conv_to_lowerc       (4121144, 5) 0:00:03.492902      
rm_punct             (4121144, 5) 0:00:26.037508      
tokenize             (4121144, 5) 0:03:10.999946      
rem_short_comments   (3462555, 5) 0:00:58.288521      
CPU times: user 1min 4s, sys: 1min 29s, total: 2min 33s
Wall time: 4min 57s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comments</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>author</th>
      <th>body</th>
      <th>created_utc</th>
      <th>id</th>
      <th>subreddit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>bikbar1</td>
      <td>[gt, but, it, s, still, impossible, to, hide, ...</td>
      <td>2020-09-06 10:11:45</td>
      <td>g47wejw</td>
      <td>Coronavirus</td>
    </tr>
    <tr>
      <th>1</th>
      <td>righteousprovidence</td>
      <td>[my, guess, is, americans, don, t, see, weldin...</td>
      <td>2020-09-06 10:13:17</td>
      <td>g47whmx</td>
      <td>Coronavirus</td>
    </tr>
    <tr>
      <th>2</th>
      <td>liriodendron1</td>
      <td>[i, dont, want, compensation, i, want, it, to,...</td>
      <td>2020-09-06 10:13:27</td>
      <td>g47whzg</td>
      <td>Coronavirus</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ArbitraryBaker</td>
      <td>[except, the, testing, is, flawed, too, have, ...</td>
      <td>2020-09-06 10:14:02</td>
      <td>g47wj5l</td>
      <td>Coronavirus</td>
    </tr>
    <tr>
      <th>4</th>
      <td>mogambis</td>
      <td>[little, did, he, know, she, is, an, it]</td>
      <td>2020-09-06 10:15:33</td>
      <td>g47wm3e</td>
      <td>Coronavirus</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4121139</th>
      <td>LouQuacious</td>
      <td>[it, s, the, 21st, century, no, excuse, for, n...</td>
      <td>2020-12-14 22:59:46</td>
      <td>gfv1k7s</td>
      <td>Coronavirus</td>
    </tr>
    <tr>
      <th>4121140</th>
      <td>immibis</td>
      <td>[covid, has, a, 1, in, 500, side, effect, of, ...</td>
      <td>2020-12-14 22:59:50</td>
      <td>gfv1kho</td>
      <td>Coronavirus</td>
    </tr>
    <tr>
      <th>4121141</th>
      <td>starlordbg</td>
      <td>[i, would, personally, wait, a, few, years, to...</td>
      <td>2020-12-14 22:59:53</td>
      <td>gfv1kqa</td>
      <td>Coronavirus</td>
    </tr>
    <tr>
      <th>4121142</th>
      <td>ihadanamebutforgot</td>
      <td>[cool, dude, lemme, know, when, science, eradi...</td>
      <td>2020-12-14 22:59:57</td>
      <td>gfv1kzb</td>
      <td>Coronavirus</td>
    </tr>
    <tr>
      <th>4121143</th>
      <td>Iknowwecanmakeit</td>
      <td>[hey, someone, has, to, represent, businesses, s]</td>
      <td>2020-12-14 22:59:57</td>
      <td>gfv1l1e</td>
      <td>Coronavirus</td>
    </tr>
  </tbody>
</table>
<p>3462555 rows × 5 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">corpus</span> <span class="o">=</span> <span class="n">Corpus</span><span class="p">(</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 27min 59s, sys: 45.9 s, total: 28min 45s
Wall time: 6min 48s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>94816</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">models/</span><span class="si">{</span><span class="n">SUBR</span><span class="si">}</span><span class="s1">.model&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Load-models">Load models<a class="anchor-link" href="#Load-models"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">SUBRS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Coronavirus&#39;</span><span class="p">,</span> <span class="s1">&#39;conspiracy&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_1</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">models/</span><span class="si">{</span><span class="n">SUBRS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">.model&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_2</span> <span class="o">=</span> <span class="n">Word2Vec</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">models/</span><span class="si">{</span><span class="n">SUBRS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">.model&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Align-models">Align models<a class="anchor-link" href="#Align-models"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_1_vocab</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)</span>
<span class="n">model_2_vocab</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_2</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">smart_procrustes_align_gensim</span><span class="p">(</span><span class="n">model_1</span><span class="p">,</span> <span class="n">model_2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>67181 67181
67181 67181
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;gensim.models.word2vec.Word2Vec at 0x1c5394850&gt;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_2</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">vectors</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">models_vocab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Model&#39;</span><span class="p">,</span> <span class="s1">&#39;Words&#39;</span><span class="p">],</span>
    <span class="n">data</span><span class="o">=</span><span class="p">[</span>
        <span class="p">[</span><span class="n">SUBRS</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">model_1_vocab</span><span class="p">],</span>
        <span class="p">[</span><span class="n">SUBRS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">model_2_vocab</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;intersection&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_1</span><span class="o">.</span><span class="n">wv</span><span class="o">.</span><span class="n">key_to_index</span><span class="p">)]</span>
    <span class="p">],</span>
<span class="p">)</span>

<span class="n">models_vocab</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Model</th>
      <th>Words</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Coronavirus</td>
      <td>94816</td>
    </tr>
    <tr>
      <th>1</th>
      <td>conspiracy</td>
      <td>112599</td>
    </tr>
    <tr>
      <th>2</th>
      <td>intersection</td>
      <td>67181</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">models_vocab</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">OUT_DIR</span><span class="si">}</span><span class="s1">models_subrs_vocab.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Measure-distances">Measure distances<a class="anchor-link" href="#Measure-distances"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">distances</span> <span class="o">=</span> <span class="n">measure_distances</span><span class="p">(</span><span class="n">model_1</span><span class="p">,</span> <span class="n">model_2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="words-that-differ-the-most-between-both-communities">words that differ the most between both communities<a class="anchor-link" href="#words-that-differ-the-most-between-both-communities"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">freq_min</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">distances</span>\
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;freq_1 &gt; @freq_min and freq_2 &gt; @freq_min&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;dist_sem&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lex</th>
      <th>dist_sem</th>
      <th>freq_1</th>
      <th>freq_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>21288</th>
      <td>ptb</td>
      <td>1.144010</td>
      <td>103</td>
      <td>144</td>
    </tr>
    <tr>
      <th>270</th>
      <td>sticky</td>
      <td>1.035551</td>
      <td>76776</td>
      <td>69776</td>
    </tr>
    <tr>
      <th>18320</th>
      <td>refraction</td>
      <td>1.021251</td>
      <td>142</td>
      <td>196</td>
    </tr>
    <tr>
      <th>9409</th>
      <td>accumulative</td>
      <td>1.011545</td>
      <td>539</td>
      <td>667</td>
    </tr>
    <tr>
      <th>1262</th>
      <td>pms</td>
      <td>1.010546</td>
      <td>11535</td>
      <td>11405</td>
    </tr>
    <tr>
      <th>3996</th>
      <td>soliciting</td>
      <td>0.989504</td>
      <td>2233</td>
      <td>2472</td>
    </tr>
    <tr>
      <th>4719</th>
      <td>resubmit</td>
      <td>0.944866</td>
      <td>1763</td>
      <td>1928</td>
    </tr>
    <tr>
      <th>895</th>
      <td>ss</td>
      <td>0.944818</td>
      <td>18100</td>
      <td>17373</td>
    </tr>
    <tr>
      <th>16111</th>
      <td>ets</td>
      <td>0.933242</td>
      <td>184</td>
      <td>252</td>
    </tr>
    <tr>
      <th>17845</th>
      <td>waiters</td>
      <td>0.929376</td>
      <td>150</td>
      <td>206</td>
    </tr>
    <tr>
      <th>257</th>
      <td>chain</td>
      <td>0.929052</td>
      <td>79084</td>
      <td>73908</td>
    </tr>
    <tr>
      <th>19967</th>
      <td>curiously</td>
      <td>0.928779</td>
      <td>119</td>
      <td>164</td>
    </tr>
    <tr>
      <th>1210</th>
      <td>subsequently</td>
      <td>0.924492</td>
      <td>12174</td>
      <td>11956</td>
    </tr>
    <tr>
      <th>16368</th>
      <td>formats</td>
      <td>0.921073</td>
      <td>178</td>
      <td>244</td>
    </tr>
    <tr>
      <th>13569</th>
      <td>anons</td>
      <td>0.920570</td>
      <td>259</td>
      <td>351</td>
    </tr>
    <tr>
      <th>20911</th>
      <td>blacklivesmatter</td>
      <td>0.918460</td>
      <td>108</td>
      <td>150</td>
    </tr>
    <tr>
      <th>140</th>
      <td>meta</td>
      <td>0.917502</td>
      <td>144695</td>
      <td>156993</td>
    </tr>
    <tr>
      <th>19917</th>
      <td>redpill</td>
      <td>0.914164</td>
      <td>119</td>
      <td>165</td>
    </tr>
    <tr>
      <th>15058</th>
      <td>derek</td>
      <td>0.913568</td>
      <td>211</td>
      <td>288</td>
    </tr>
    <tr>
      <th>14487</th>
      <td>ic</td>
      <td>0.902983</td>
      <td>228</td>
      <td>310</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="nearest-neighbours-for-target-lexemes-in-both-communities">nearest neighbours for target lexemes in both communities<a class="anchor-link" href="#nearest-neighbours-for-target-lexemes-in-both-communities"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">LEX</span> <span class="o">=</span> <span class="s1">&#39;vaccine&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nbs_model_1</span><span class="p">,</span> <span class="n">nbs_model_2</span> <span class="o">=</span> <span class="n">get_nearest_neighbours_models</span><span class="p">(</span>
    <span class="n">lex</span><span class="o">=</span><span class="n">LEX</span><span class="p">,</span> 
    <span class="n">freq_min</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">model_1</span><span class="o">=</span><span class="n">model_1</span><span class="p">,</span> 
    <span class="n">model_2</span><span class="o">=</span><span class="n">model_2</span><span class="p">,</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">nbs_model_1</span><span class="p">,</span> <span class="n">nbs_model_2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>lex</th>
      <th>similarity</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>vaccines</td>
      <td>0.754159</td>
      <td>41005</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>vaccin</td>
      <td>0.745905</td>
      <td>108</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>vaccination</td>
      <td>0.633033</td>
      <td>7667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>vaccinations</td>
      <td>0.569226</td>
      <td>3305</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>jab</td>
      <td>0.531420</td>
      <td>713</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>drug</td>
      <td>0.519127</td>
      <td>19090</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>novavax</td>
      <td>0.515097</td>
      <td>158</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>cure</td>
      <td>0.507441</td>
      <td>8142</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>vax</td>
      <td>0.491517</td>
      <td>2940</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>eua</td>
      <td>0.490937</td>
      <td>702</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>lex</th>
      <th>similarity</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>21542</th>
      <td>2</td>
      <td>vaccines</td>
      <td>0.770874</td>
      <td>37084</td>
    </tr>
    <tr>
      <th>21543</th>
      <td>2</td>
      <td>vaccination</td>
      <td>0.723819</td>
      <td>7780</td>
    </tr>
    <tr>
      <th>21544</th>
      <td>2</td>
      <td>vaccinations</td>
      <td>0.656477</td>
      <td>3624</td>
    </tr>
    <tr>
      <th>21545</th>
      <td>2</td>
      <td>vax</td>
      <td>0.649080</td>
      <td>3208</td>
    </tr>
    <tr>
      <th>21546</th>
      <td>2</td>
      <td>vac</td>
      <td>0.586291</td>
      <td>206</td>
    </tr>
    <tr>
      <th>21547</th>
      <td>2</td>
      <td>immunization</td>
      <td>0.543347</td>
      <td>701</td>
    </tr>
    <tr>
      <th>21548</th>
      <td>2</td>
      <td>inoculation</td>
      <td>0.538037</td>
      <td>319</td>
    </tr>
    <tr>
      <th>21549</th>
      <td>2</td>
      <td>jab</td>
      <td>0.530465</td>
      <td>850</td>
    </tr>
    <tr>
      <th>21550</th>
      <td>2</td>
      <td>rubella</td>
      <td>0.528231</td>
      <td>333</td>
    </tr>
    <tr>
      <th>21551</th>
      <td>2</td>
      <td>vaccinated</td>
      <td>0.526829</td>
      <td>11762</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="biggest-discrepancies-in-nearest-neighbours-for-target-lexemes">biggest discrepancies in nearest neighbours for target lexemes<a class="anchor-link" href="#biggest-discrepancies-in-nearest-neighbours-for-target-lexemes"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nbs_model_1</span><span class="p">,</span> <span class="n">nbs_model_2</span> <span class="o">=</span> <span class="n">get_nearest_neighbours_models</span><span class="p">(</span>
    <span class="n">lex</span><span class="o">=</span><span class="n">LEX</span><span class="p">,</span> 
    <span class="n">freq_min</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
    <span class="n">model_1</span><span class="o">=</span><span class="n">model_1</span><span class="p">,</span> 
    <span class="n">model_2</span><span class="o">=</span><span class="n">model_2</span><span class="p">,</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">100_000</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nbs_diffs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
    <span class="n">nbs_model_1</span><span class="p">,</span> <span class="n">nbs_model_2</span><span class="p">,</span> 
    <span class="n">on</span><span class="o">=</span><span class="s1">&#39;lex&#39;</span><span class="p">,</span>
    <span class="n">suffixes</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;_1&#39;</span><span class="p">,</span> <span class="s1">&#39;_2&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nbs_diffs</span> <span class="o">=</span> <span class="n">nbs_diffs</span>\
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">sim_diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nbs_diffs</span><span class="p">[</span><span class="s1">&#39;similarity_1&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">nbs_diffs</span><span class="p">[</span><span class="s1">&#39;similarity_2&#39;</span><span class="p">]))</span>\
    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;sim_diff&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;lex.str.len() &gt;= 4&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">topn</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">subr_1_nbs</span> <span class="o">=</span> <span class="n">nbs_diffs</span>\
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;similarity_1 &gt; similarity_2&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">topn</span><span class="p">,</span> <span class="s1">&#39;sim_diff&#39;</span><span class="p">)</span>

<span class="n">subr_2_nbs</span> <span class="o">=</span> <span class="n">nbs_diffs</span>\
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;similarity_2 &gt; similarity_1&#39;</span><span class="p">)</span>\
    <span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">topn</span><span class="p">,</span> <span class="s1">&#39;sim_diff&#39;</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">subr_1_nbs</span><span class="p">,</span> <span class="n">subr_2_nbs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model_1</th>
      <th>lex</th>
      <th>similarity_1</th>
      <th>freq_1</th>
      <th>model_2</th>
      <th>similarity_2</th>
      <th>freq_2</th>
      <th>sim_diff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>100m</td>
      <td>0.328007</td>
      <td>439</td>
      <td>2</td>
      <td>0.039867</td>
      <td>557</td>
      <td>0.288140</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1</td>
      <td>beta</td>
      <td>0.352028</td>
      <td>842</td>
      <td>2</td>
      <td>0.070071</td>
      <td>999</td>
      <td>0.281957</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1</td>
      <td>vladimir</td>
      <td>0.166982</td>
      <td>279</td>
      <td>2</td>
      <td>-0.108522</td>
      <td>375</td>
      <td>0.275504</td>
    </tr>
    <tr>
      <th>20</th>
      <td>1</td>
      <td>sputnik</td>
      <td>0.367858</td>
      <td>279</td>
      <td>2</td>
      <td>0.113972</td>
      <td>376</td>
      <td>0.253886</td>
    </tr>
    <tr>
      <th>21</th>
      <td>1</td>
      <td>vanilla</td>
      <td>0.104741</td>
      <td>168</td>
      <td>2</td>
      <td>-0.147005</td>
      <td>230</td>
      <td>0.251746</td>
    </tr>
    <tr>
      <th>23</th>
      <td>1</td>
      <td>lamp</td>
      <td>0.179237</td>
      <td>224</td>
      <td>2</td>
      <td>-0.070934</td>
      <td>305</td>
      <td>0.250171</td>
    </tr>
    <tr>
      <th>25</th>
      <td>1</td>
      <td>fades</td>
      <td>0.220316</td>
      <td>153</td>
      <td>2</td>
      <td>-0.027544</td>
      <td>211</td>
      <td>0.247860</td>
    </tr>
    <tr>
      <th>26</th>
      <td>1</td>
      <td>paintings</td>
      <td>0.071031</td>
      <td>230</td>
      <td>2</td>
      <td>-0.176508</td>
      <td>312</td>
      <td>0.247539</td>
    </tr>
    <tr>
      <th>29</th>
      <td>1</td>
      <td>oxford</td>
      <td>0.354030</td>
      <td>4128</td>
      <td>2</td>
      <td>0.114557</td>
      <td>4378</td>
      <td>0.239473</td>
    </tr>
    <tr>
      <th>31</th>
      <td>1</td>
      <td>fade</td>
      <td>0.202643</td>
      <td>490</td>
      <td>2</td>
      <td>-0.034802</td>
      <td>610</td>
      <td>0.237445</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model_1</th>
      <th>lex</th>
      <th>similarity_1</th>
      <th>freq_1</th>
      <th>model_2</th>
      <th>similarity_2</th>
      <th>freq_2</th>
      <th>sim_diff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>neuralink</td>
      <td>-0.004440</td>
      <td>210</td>
      <td>2</td>
      <td>0.341604</td>
      <td>285</td>
      <td>0.346044</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>optional</td>
      <td>-0.055179</td>
      <td>731</td>
      <td>2</td>
      <td>0.262431</td>
      <td>871</td>
      <td>0.317610</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>mandated</td>
      <td>-0.074730</td>
      <td>2455</td>
      <td>2</td>
      <td>0.226452</td>
      <td>2730</td>
      <td>0.301182</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>dysphoria</td>
      <td>-0.081338</td>
      <td>210</td>
      <td>2</td>
      <td>0.207875</td>
      <td>286</td>
      <td>0.289212</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>coronavirus</td>
      <td>0.004444</td>
      <td>218095</td>
      <td>2</td>
      <td>0.289353</td>
      <td>261193</td>
      <td>0.284909</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>cv19</td>
      <td>0.072748</td>
      <td>539</td>
      <td>2</td>
      <td>0.357341</td>
      <td>667</td>
      <td>0.284593</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1</td>
      <td>untested</td>
      <td>0.177692</td>
      <td>796</td>
      <td>2</td>
      <td>0.462222</td>
      <td>950</td>
      <td>0.284530</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1</td>
      <td>locale</td>
      <td>-0.117035</td>
      <td>575</td>
      <td>2</td>
      <td>0.165845</td>
      <td>704</td>
      <td>0.282880</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1</td>
      <td>disrespecting</td>
      <td>-0.179820</td>
      <td>231</td>
      <td>2</td>
      <td>0.097078</td>
      <td>314</td>
      <td>0.276898</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1</td>
      <td>pediatric</td>
      <td>0.032584</td>
      <td>357</td>
      <td>2</td>
      <td>0.307942</td>
      <td>467</td>
      <td>0.275358</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

